<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Guessing Game</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px;background-color: plum; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; margin-bottom: 10px; }
    #players { margin-bottom: 10px; }
    #leaderboard { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    input, button { padding: 5px; margin: 5px 0; }
    .session-box {
      margin: 20px;
      padding: 10px;
      border: 2px solid #444;
      border-radius: 8px;
      display: inline-block;
    }
    button {
      margin-left: 10px;
      padding: 5px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Guessing Game</h1>

  <div>
    <input type="text" id="username" placeholder="Your name" />
    <input type="text" id="sessionId" placeholder="Session ID" />
    <button id="createSessionBtn">Create Session</button>
    <button id="joinSessionBtn">Join Session</button>
  </div>
  <!-- <div>
    <h3>Players Connected</h3>
    <ul id="players"></ul>
  </div> -->
  
  <div id="players">Players connected: 0</div>
  <div id="leaderboard">Leaderboard:</div>
  <div id="chat"></div>

  <div>
    <input type="text" id="questionInput" placeholder="Enter question" />
    <input type="text" id="answerInput" placeholder="Enter answer" />
    <button id="setQuestionBtn">Set Question</button>
    <button id="startGameBtn">Start Game</button>
  </div>

  <div>
    <input type="text" id="guessInput" placeholder="Your guess" />
    <button id="guessBtn">Submit Guess</button>
  </div>
  <div id="sessionBox" class="session-box"></div>
  <!-- <div class="session-box">
    <span id="sessionCode"></span>
    <button onclick="copyCode()">üìã Copy</button>
  </div> -->

  <script>
    const socket = io('http://localhost:3000');

    const usernameInput = document.getElementById('username');
    const sessionIdInput = document.getElementById('sessionId');
    const chatDiv = document.getElementById('chat');
    const playersDiv = document.getElementById('players');
    const leaderboardDiv = document.getElementById('leaderboard');

    document.getElementById('createSessionBtn').onclick = () => {
      socket.emit('createSession', {
        sessionCode: sessionIdInput.value,
        master: usernameInput.value
      });
    };

    document.getElementById('joinSessionBtn').onclick = () => {
      socket.emit('joinSession', {
        sessionCode: sessionIdInput.value,
        username: usernameInput.value
      });
    };

    document.getElementById('setQuestionBtn').onclick = () => {
      socket.emit('setQuestion', {
        sessionCode: sessionIdInput.value,
        question: document.getElementById('questionInput').value,
        answer: document.getElementById('answerInput').value
      });
    };

    document.getElementById('startGameBtn').onclick = () => {
      socket.emit('startGame', { sessionCode: sessionIdInput.value });
    };

    // document.getElementById('endGameBtn').onclick =()=>{
    //     socket.emit('endGame',{sessionCode})
    // }
    document.getElementById('guessBtn').onclick = () => {
      socket.emit('guess', {
        sessionCode: sessionIdInput.value,
        guess: document.getElementById('guessInput').value
      });
    };

    // Listen for updates
    // socket.on('updatedPlayers', (players) => {
    //   playersDiv.innerText = `Players connected: ${players.length} ‚Üí ${players.map(p => p.username).join(', ')}`;
    //   updateLeaderboard(players);
    // });
    socket.on("playerList", (players) => {
  const playerListDiv = document.getElementById("players");
  playerListDiv.innerHTML = players.map(p => `<li>${p.username} (${p.score})</li>`).join("");
});


  socket.on("sessionCreated", ({ sessionCode }) => {
    console.log("üì¢ Session created, code received:", sessionCode);

    // Create the HTML dynamically
    document.getElementById("sessionBox").innerHTML = `
      <span id="sessionCode">${sessionCode}</span>
      <button onclick="copyCode()">üìã Copy</button>
    `;

    chatDiv.innerHTML += `<div>Session ${sessionCode} created. You are the game master.</div>`;
  });

  // Clear session code box when game ends
  socket.on("gameEnded", ({ message, winner }) => {
    console.log("üéÆ Game ended:", message);

    // Remove session box
    document.getElementById("sessionBox").innerHTML = "";

    // Show game result in chat
    chatDiv.innerHTML += `<div>${message}</div>`;
    if (winner) {
      chatDiv.innerHTML += `<div>üèÜ Winner: ${winner}</div>`;
    }
  });

  function copyCode() {
    const code = document.getElementById("sessionCode")?.innerText.trim();
    
    if (!code) {
      alert("‚ö†Ô∏è No session code to copy!");
      return;
    }

    navigator.clipboard.writeText(code)
      .then(() => alert("‚úÖ Session code copied: " + code))
      .catch(err => console.error("Failed to copy code", err));
  }


    socket.on('newQuestion', ({ question }) => {
      chatDiv.innerHTML += `<div>New Question: ${question}</div>`;
    });

    socket.on('gameStarted', ({ message }) => {
      chatDiv.innerHTML += `<div style="color:green">${message}</div>`;
    });

    socket.on('wrongGuess', (msg) => {
      chatDiv.innerHTML += `<div style="color:red">${msg}</div>`;
    });

    socket.on('attemptsOver', (msg) => {
      chatDiv.innerHTML += `<div style="color:orange">${msg}</div>`;
    });

    socket.on('gameEnded', ({ message, winner, players }) => {
      chatDiv.innerHTML += `<div style="color:blue">${message}${winner ? ' Winner: ' + winner : ''}</div>`;
      updateLeaderboard(players);
    });

    socket.on('error', (msg) => {
      chatDiv.innerHTML += `<div style="color:red">Error: ${msg}</div>`;
    });
     


    function updateLeaderboard(players) {
      if (!players) return;
      let html = "<strong>Leaderboard:</strong><br/>";
      players.forEach(p => {
        html += `${p.username}: ${p.score} pts<br/>`;
      });
      leaderboardDiv.innerHTML = html;
    }
  </script>
</body>
</html>
